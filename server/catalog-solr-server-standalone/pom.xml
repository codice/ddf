<!--
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either
 * version 3 of the License, or any later version. 
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public License is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<artifactId>catalog-solr-server-pom</artifactId>
		<groupId>ddf.catalog.solr.server</groupId>
		<version>2.4.1-SNAPSHOT</version>
	</parent>

	<artifactId>catalog-solr-server-standalone</artifactId>
	<name>DDF :: Catalog :: Solr :: Server :: Standalone War</name>
	<packaging>war</packaging>

	<dependencies>
		<dependency>
			<groupId>org.apache.solr</groupId>
			<artifactId>solr</artifactId>
			<version>${solr.version}</version>
			<type>war</type>
		</dependency>
	</dependencies>

	<build>
		<plugins>

			<!-- 
				We only need to add one jar for extra spatial capabilities.
				If we use the mvn bundle plugin, it will unnecessarily add extra
				jars within the war. If we exclude the jars to be added, it will
				add extra imports (packages) that we do not want either.
				This is a workaround to add jars to the war without the bnd tool
				mistakenly bringing in 7 or 8 extra jars. This helps to keep the classpath 
				cleaner and the war smaller. 
			 -->
			<plugin>
				<artifactId>maven-dependency-plugin</artifactId>
				<executions>
					<execution>
						<id>copy</id>
						<phase>process-resources</phase>
						<goals>
							<goal>copy</goal>
						</goals>
						<configuration>
							<artifactItems>
                                <!-- Needed for XPath query parser and filter -->
                                <artifactItem>
                                    <groupId>ddf.catalog.solr</groupId>
                                    <artifactId>solr-xpath</artifactId>
                                    <version>${project.version}</version>
                                    <type>jar</type>
                                    <overWrite>true</overWrite>
                                    <outputDirectory>${project.build.directory}/${project.artifactId}-${project.version}/WEB-INF/lib</outputDirectory>
                                </artifactItem>
                                <!-- Next 3 needed for LuxDB -->
                                <artifactItem>
                                    <groupId>org.luxdb</groupId>
                                    <artifactId>lux</artifactId>
                                    <version>${lux.version}</version>
                                    <type>jar</type>
                                    <overWrite>true</overWrite>
                                    <outputDirectory>${project.build.directory}/${project.artifactId}-${project.version}/WEB-INF/lib</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>net.sf.saxon</groupId>
                                    <artifactId>Saxon-HE</artifactId>
                                    <version>9.5.1-3</version>
                                    <type>jar</type>
                                    <overWrite>true</overWrite>
                                    <outputDirectory>${project.build.directory}/${project.artifactId}-${project.version}/WEB-INF/lib</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.codehaus.woodstox</groupId>
                                    <artifactId>stax2-api</artifactId>
                                    <version>3.1.1</version>
                                    <type>jar</type>
                                    <overWrite>true</overWrite>
                                    <outputDirectory>${project.build.directory}/${project.artifactId}-${project.version}/WEB-INF/lib</outputDirectory>
                                </artifactItem>
							</artifactItems>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<artifactId>maven-war-plugin</artifactId>
				<configuration>
					<archive>
						<manifestFile>${project.build.outputDirectory}/META-INF/MANIFEST.MF</manifestFile>
					</archive>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.felix</groupId>
				<artifactId>maven-bundle-plugin</artifactId>
				<executions>
					<execution>
						<id>bundle-manifest</id>
						<phase>process-classes</phase>
						<goals>
							<goal>manifest</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<supportedProjectTypes>
						<supportedProjectType>war</supportedProjectType>
					</supportedProjectTypes>

					<instructions>
						<Bundle-SymbolicName>${project.artifactId}</Bundle-SymbolicName>
						<Web-ContextPath>solr</Web-ContextPath>
						<Export-Package />
						<Bundle-ClassPath>
							WEB-INF/classes,
							<!--
							According to Pax Web documentation,
							"you should have an entry for each jar you have in your lib directory"
							http://team.ops4j.org/wiki/display/paxweb/OSGi-fy+your+WAR
							 -->
							WEB-INF/lib/commons-io-2.1.jar,
                            WEB-INF/lib/lux-${lux.version}.jar,
                            WEB-INF/lib/Saxon-HE-9.5.1-3.jar,
                            WEB-INF/lib/solr-xpath-${project.version}.jar,
                            WEB-INF/lib/stax2-api-3.1.1.jar,
							WEB-INF/lib/woodstox-core-asl-${woodstox.version}.jar,

                            <!-- Solr WAR libs -->
                            WEB-INF/lib/antlr-runtime-3.5.jar,
                            WEB-INF/lib/asm-4.1.jar,
                            WEB-INF/lib/asm-commons-4.1.jar,
                            WEB-INF/lib/commons-cli-1.2.jar,
                            WEB-INF/lib/commons-codec-1.7.jar,
                            WEB-INF/lib/commons-configuration-1.6.jar,
                            WEB-INF/lib/commons-fileupload-1.2.1.jar,
                            WEB-INF/lib/commons-lang-2.6.jar,
                            WEB-INF/lib/concurrentlinkedhashmap-lru-1.2.jar,
                            WEB-INF/lib/dom4j-1.6.1.jar,
                            WEB-INF/lib/guava-14.0.1.jar,
                            WEB-INF/lib/hadoop-annotations-2.2.0.jar,
                            WEB-INF/lib/hadoop-auth-2.2.0.jar,
                            WEB-INF/lib/hadoop-common-2.2.0.jar,
                            WEB-INF/lib/hadoop-hdfs-2.2.0.jar,
                            WEB-INF/lib/hppc-0.5.2.jar,
                            WEB-INF/lib/joda-time-2.2.jar,
                            WEB-INF/lib/org.restlet-2.1.1.jar,
                            WEB-INF/lib/org.restlet.ext.servlet-2.1.1.jar,
                            WEB-INF/lib/protobuf-java-2.5.0.jar,
                            WEB-INF/lib/spatial4j-0.4.1.jar,
                            WEB-INF/lib/commons-io-2.1.jar,
                            WEB-INF/lib/httpclient-4.3.1.jar,
                            WEB-INF/lib/httpcore-4.3.jar,
                            WEB-INF/lib/httpmime-4.3.1.jar,
                            WEB-INF/lib/noggit-0.5.jar,
                            WEB-INF/lib/wstx-asl-3.2.7.jar,
                            WEB-INF/lib/zookeeper-3.4.5.jar,
                            WEB-INF/lib/lucene-analyzers-common-4.7.2.jar,
                            WEB-INF/lib/lucene-analyzers-kuromoji-4.7.2.jar,
                            WEB-INF/lib/lucene-analyzers-phonetic-4.7.2.jar,
                            WEB-INF/lib/lucene-codecs-4.7.2.jar,
                            WEB-INF/lib/lucene-core-4.7.2.jar,
                            WEB-INF/lib/lucene-expressions-4.7.2.jar,
                            WEB-INF/lib/lucene-grouping-4.7.2.jar,
                            WEB-INF/lib/lucene-highlighter-4.7.2.jar,
                            WEB-INF/lib/lucene-join-4.7.2.jar,
                            WEB-INF/lib/lucene-memory-4.7.2.jar,
                            WEB-INF/lib/lucene-misc-4.7.2.jar,
                            WEB-INF/lib/lucene-queries-4.7.2.jar,
                            WEB-INF/lib/lucene-queryparser-4.7.2.jar,
                            WEB-INF/lib/lucene-spatial-4.7.2.jar,
                            WEB-INF/lib/lucene-suggest-4.7.2.jar,
                            WEB-INF/lib/solr-core-4.7.2.jar,
                            WEB-INF/lib/solr-solrj-4.7.2.jar
						</Bundle-ClassPath>
						<Import-Package>
							com.vividsolutions.jts.algorithm,
							com.vividsolutions.jts.geom,
                            com.vividsolutions.jts.geom.impl,
							com.vividsolutions.jts.io,
							com.vividsolutions.jts.operation.union,
							com.vividsolutions.jts.operation.valid,
							com.vividsolutions.jts.simplify,
							com.vividsolutions.jts.util,
                            javax.crypto,
                            javax.crypto.spec,
                            javax.management,
                            javax.management.openmbean,
                            javax.management.remote,
                            javax.naming,
                            javax.net.ssl,
                            javax.servlet;version="2.5",
							javax.servlet.http,
                            javax.xml.namespace,
							javax.xml.parsers,
                            javax.xml.stream,
                            javax.xml.stream.events,
                            javax.xml.stream.util,
                            javax.xml.transform,
                            javax.xml.transform.dom,
                            javax.xml.transform.sax,
                            javax.xml.transform.stream,
                            javax.xml.xpath,
                            jline,
                            org.apache.commons.logging,
                            org.apache.commons.logging.impl,
                            org.apache.xerces.parsers,
                            org.apache.xerces.xni.parser,
                            org.slf4j,
							org.xml.sax,
							org.w3c.dom,
                            org.xml.sax.ext,
                            org.xml.sax.helpers
						</Import-Package>
					</instructions>
				</configuration>
			</plugin>
		</plugins>
	</build>
</project>