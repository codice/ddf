<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either
 * version 3 of the License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public License is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
-->
<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="http://maven.apache.org/POM/4.0.0"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <artifactId>kernel</artifactId>
        <groupId>org.codice.ddf</groupId>
        <version>2.16.0-SNAPSHOT</version>
        <relativePath>../kernel/pom.xml</relativePath>
    </parent>
    <!--
    Packages the DDF Standard distribution, which consists of the DDF Core distribution.

    Note that this distribution has the DDF Kernel distribution as its parent, hence all of the maven goals in the DDF Kernel distribution pom will execute unless they are overridden in this pom.
    -->
    <artifactId>ddf</artifactId>
    <name>DDF :: Distribution :: DDF</name>
    <packaging>pom</packaging>
    <properties>
        <distribution.file.name>ddf-${project.version}</distribution.file.name>
    </properties>
    <build>
        <resources>
            <!--
            Resources for this distribution include its features XML file and the Apache Karaf
            .cfg file that defines the feature repositories and list of features to install at startup.
            -->
            <resource>
                <directory>src/main/filtered-resources</directory>
                <filtering>true</filtering>
                <includes>
                    <include>**/*</include>
                </includes>
            </resource>
        </resources>
        <plugins>
            <!--
                Adds all of the feature repositories from DDF Kernel distribution, and this DDF Standard distribution to the Karaf system folder, which is the repo for Karar at runtime.
            -->
            <plugin>
                <groupId>org.apache.karaf.tooling</groupId>
                <artifactId>karaf-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <id>features-add-to-repository</id>
                        <phase>prepare-package</phase>
                        <goals>
                            <goal>features-add-to-repository</goal>
                        </goals>
                        <configuration>
                            <addTransitiveFeatures>false</addTransitiveFeatures>
                            <descriptors>
                                <descriptor>
                                    mvn:ddf.features/install-profiles/${project.version}/xml/features
                                </descriptor>
                                <descriptor>
                                    mvn:org.codice.ddf/ui/${project.version}/xml/features
                                </descriptor>
                            </descriptors>
                            <repository>${setup.folder}/${karaf.folder}/system</repository>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-dependency-plugin</artifactId>
                <executions>
                    <execution>
                        <id>copy-docs</id>
                        <!--
                        The unpack needs to run in an earlier phase than the copy,
                        due to a recurring bug in maven that causes plugins in the
                        same lifecycle phase to run in orders other than that which
                        they were declared in.

                        See https://issues.apache.org/jira/browse/MNG-5799 as well
                        as the related tickets for more details.
                        -->
                        <phase>process-resources</phase>
                        <goals>
                            <goal>unpack</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>ddf</groupId>
                                    <artifactId>docs</artifactId>
                                    <version>${project.version}</version>
                                    <outputDirectory>${setup.folder}/docs
                                    </outputDirectory>
                                    <overWrite>true</overWrite>
                                    <classifier>docs-export</classifier>
                                    <type>zip</type>
                                </artifactItem>
                            </artifactItems>
                            <overWriteSnapshots>true</overWriteSnapshots>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
    <profiles>
        <!--
        Runs OWASP on the DDF distribution zip file.
        -->
        <profile>
            <id>owasp-dist</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.owasp</groupId>
                        <artifactId>dependency-check-maven</artifactId>
                        <configuration>
                            <scanSet>
                                <fileSet>
                                    <directory>${project.build.directory}</directory>
                                    <includes>
                                        <include>${distribution.file.name}.zip</include>
                                    </includes>
                                </fileSet>
                            </scanSet>
                        </configuration>
                        <executions>
                            <execution>
                                <phase>verify</phase>
                                <goals>
                                    <goal>check</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
            <reporting>
                <plugins>
                    <plugin>
                        <artifactId>maven-checkstyle-plugin</artifactId>
                        <configuration>
                            <skip>true</skip>
                        </configuration>
                    </plugin>
                    <plugin>
                        <groupId>org.owasp</groupId>
                        <artifactId>dependency-check-maven</artifactId>
                    </plugin>
                </plugins>
            </reporting>
        </profile>
        <profile>
            <id>release</id>
            <dependencies>
                <dependency>
                    <groupId>ddf.catalog.core</groupId>
                    <artifactId>catalog-core-api</artifactId>
                    <version>${project.version}</version>
                    <type>javadoc</type>
                </dependency>
                <dependency>
                    <groupId>ddf.mime.core</groupId>
                    <artifactId>mime-core-api</artifactId>
                    <version>${project.version}</version>
                    <type>javadoc</type>
                </dependency>
                <dependency>
                    <groupId>ddf.action.core</groupId>
                    <artifactId>action-core-api</artifactId>
                    <version>${project.version}</version>
                    <type>javadoc</type>
                </dependency>
                <dependency>
                    <groupId>ddf.security.core</groupId>
                    <artifactId>security-core-api</artifactId>
                    <version>${project.version}</version>
                    <type>javadoc</type>
                </dependency>
                <dependency>
                    <groupId>ddf.security.encryption</groupId>
                    <artifactId>security-encryption-api</artifactId>
                    <version>${project.version}</version>
                    <type>javadoc</type>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>unpack-javadoc</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>unpack</goal>
                                </goals>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>ddf.catalog.core</groupId>
                                            <artifactId>catalog-core-api</artifactId>
                                            <version>${project.version}</version>
                                            <type>javadoc</type>
                                            <outputDirectory>${setup.folder}/catalog_api_javadoc
                                            </outputDirectory>
                                        </artifactItem>
                                        <artifactItem>
                                            <groupId>ddf.mime.core</groupId>
                                            <artifactId>mime-core-api</artifactId>
                                            <version>${project.version}</version>
                                            <type>javadoc</type>
                                            <outputDirectory>${setup.folder}/mime_api_javadoc
                                            </outputDirectory>
                                        </artifactItem>
                                        <artifactItem>
                                            <groupId>ddf.action.core</groupId>
                                            <artifactId>action-core-api</artifactId>
                                            <version>${project.version}</version>
                                            <type>javadoc</type>
                                            <outputDirectory>${setup.folder}/action_api_javadoc
                                            </outputDirectory>
                                        </artifactItem>
                                        <artifactItem>
                                            <groupId>ddf.security.core</groupId>
                                            <artifactId>security-core-api</artifactId>
                                            <version>${project.version}</version>
                                            <type>javadoc</type>
                                            <outputDirectory>${setup.folder}/security_api_javadoc
                                            </outputDirectory>
                                        </artifactItem>
                                        <artifactItem>
                                            <groupId>ddf.security.encryption</groupId>
                                            <artifactId>security-encryption-api</artifactId>
                                            <version>${project.version}</version>
                                            <type>javadoc</type>
                                            <outputDirectory>
                                                ${setup.folder}/encryption_api_javadoc
                                            </outputDirectory>
                                        </artifactItem>
                                    </artifactItems>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
    <dependencies>
        <dependency>
            <groupId>ddf</groupId>
            <artifactId>docs</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>ddf.features</groupId>
            <artifactId>install-profiles</artifactId>
            <version>${project.version}</version>
            <classifier>features</classifier>
            <type>xml</type>
        </dependency>
        <dependency>
            <groupId>org.codice.ddf</groupId>
            <artifactId>ui</artifactId>
            <version>${project.version}</version>
            <classifier>features</classifier>
            <type>xml</type>
        </dependency>
    </dependencies>
</project>
