<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either
 * version 3 of the License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public License is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <artifactId>kernel</artifactId>
        <groupId>org.codice.ddf</groupId>
        <version>3.0.0-SNAPSHOT</version>
        <relativePath>../kernel/pom.xml</relativePath>
    </parent>
    <!--
    Packages the DDF Standard distribution, which consists of the DDF Core distribution.

    Note that this distribution has the DDF Kernel distribution as its parent, hence all of the maven goals in the DDF Kernel distribution pom will execute unless they are overridden in this pom.
    -->
    <artifactId>ddf</artifactId>
    <name>DDF :: Distribution :: DDF</name>
    <packaging>pom</packaging>
    <properties>
        <distribution.file.name>ddf-${project.version}</distribution.file.name>
    </properties>
    <build>
        <resources>
            <!--
            Resources for this distribution include its features XML file and the Apache Karaf
            .cfg file that defines the feature repositories and list of features to install at startup.
            -->
            <resource>
                <directory>src/main/filtered-resources</directory>
                <filtering>true</filtering>
                <includes>
                    <include>**/*</include>
                </includes>
            </resource>
        </resources>
        <plugins>
            <!--
                Adds all of the feature repositories from DDF Kernel distribution, and this DDF Standard distribution to the Karaf system folder, which is the repo for Karar at runtime.
            -->
            <plugin>
                <groupId>org.apache.karaf.tooling</groupId>
                <artifactId>karaf-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <id>add-ddf-features</id>
                        <phase>prepare-package</phase>
                        <goals>
                            <goal>features-add-to-repository</goal>
                        </goals>
                        <configuration>
                            <addTransitiveFeatures>true</addTransitiveFeatures>
                            <resolveDefinedRepositoriesRecursively>false</resolveDefinedRepositoriesRecursively>
                            <descriptors>
                                <descriptor>mvn:org.apache.cxf.karaf/apache-cxf/${cxf.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.karaf.features/standard/${karaf.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.karaf.features/spring/${karaf.version}/xml/features</descriptor>
                                <descriptor>mvn:org.ops4j.pax.web/pax-web-features/${pax.web.version}/xml/features</descriptor>

                                <descriptor>mvn:ddf.features/kernel/${project.version}/xml/features</descriptor>
                                <descriptor>mvn:ddf.features/install-profiles/${project.version}/xml/features</descriptor>
                                <descriptor>mvn:ddf.features/apps/${project.version}/xml/features</descriptor>
                                <descriptor>mvn:ddf.features/branding/${project.version}/xml/features</descriptor>
                                <descriptor>mvn:ddf.features/solr/${project.version}/xml/features</descriptor>
                                <descriptor>mvn:ddf.features/utilities/${project.version}/xml/features</descriptor>
                                <descriptor>mvn:ddf.catalog/catalog-app/${project.version}/xml/features</descriptor>
                                <descriptor>mvn:ddf.catalog.solr/catalog-solr-app/${project.version}/xml/features</descriptor>
                                <descriptor>mvn:org.codice.ddf.spatial/spatial-app/${project.version}/xml/features</descriptor>
                            </descriptors>
                            <features>
                                <!-- conditional features -->
                                <feature>cxf-commands</feature>
                                <!-- profile features -->
                                <feature>profile-minimum</feature>
                                <feature>profile-catalog</feature>
                                <feature>profile-standard</feature>
                            </features>
                            <repository>${setup.folder}/${karaf.folder}/system</repository>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <artifactId>maven-antrun-plugin</artifactId>
                <version>3.0.0</version>
                <executions>
                    <execution>
                        <phase>prepare-package</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <target>
                                <replaceregexp
                                        file="${project.basedir}/target/dependencies/apache-karaf-${karaf.version}/etc/jre.properties"
                                        match="java.nio.file," byline="true">
                                    <substitution expression="java.nio.file, \\\\${line.separator} java.nio.file.spi,"/>
                                </replaceregexp>
                            </target>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
    <dependencies>
        <!-- Features to add to system repository -->
        <dependency>
            <groupId>ddf.catalog</groupId>
            <artifactId>catalog-app</artifactId>
            <version>${project.version}</version>
            <type>xml</type>
            <classifier>features</classifier>
        </dependency>
        <dependency>
            <groupId>ddf.catalog.solr</groupId>
            <artifactId>catalog-solr-app</artifactId>
            <version>${project.version}</version>
            <type>xml</type>
            <classifier>features</classifier>
        </dependency>
        <dependency>
            <groupId>ddf.features</groupId>
            <artifactId>apps</artifactId>
            <version>${project.version}</version>
            <classifier>features</classifier>
            <type>xml</type>
        </dependency>
        <dependency>
            <groupId>ddf.features</groupId>
            <artifactId>branding</artifactId>
            <version>${project.version}</version>
            <classifier>features</classifier>
            <type>xml</type>
        </dependency>
        <dependency>
            <groupId>org.apache.cxf.karaf</groupId>
            <artifactId>apache-cxf</artifactId>
            <version>${cxf.version}</version>
            <type>xml</type>
            <classifier>features</classifier>
        </dependency>
        <dependency>
            <groupId>ddf.features</groupId>
            <artifactId>install-profiles</artifactId>
            <version>${project.version}</version>
            <classifier>features</classifier>
            <type>xml</type>
        </dependency>
        <dependency>
            <groupId>ddf.features</groupId>
            <artifactId>kernel</artifactId>
            <version>${project.version}</version>
            <classifier>features</classifier>
            <type>xml</type>
        </dependency>
        <dependency>
            <groupId>ddf.features</groupId>
            <artifactId>solr</artifactId>
            <version>${project.version}</version>
            <classifier>features</classifier>
            <type>xml</type>
        </dependency>
        <dependency>
            <groupId>ddf.features</groupId>
            <artifactId>utilities</artifactId>
            <version>${project.version}</version>
            <classifier>features</classifier>
            <type>xml</type>
        </dependency>
        <dependency>
            <groupId>org.codice.ddf.spatial</groupId>
            <artifactId>spatial-app</artifactId>
            <version>${project.version}</version>
            <classifier>features</classifier>
            <type>xml</type>
        </dependency>
    </dependencies>
</project>
